<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard | Combs Salon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body style="font-family: Arial; background:#f5f5f5; padding:20px;">

<h2>üìã Bookings</h2>
<hr>

<div id="bookings">Loading bookings...</div>

<script>
/* üîê Protect dashboard */
if (!localStorage.getItem("admin")) {
  alert("Unauthorized access");
  window.location.href = "admin.html";
}

/* üì° Fetch bookings */
fetch("https://saloon-backend-plfu.onrender.com/api/bookings")
  .then(res => res.json())
  .then(data => {
    document.getElementById("bookings").innerHTML =
      data.map(b => `
        <div style="
          background:white;
          padding:15px;
          margin-bottom:15px;
          border-radius:8px;
          box-shadow:0 2px 5px rgba(0,0,0,0.1);
        ">
          <h4>${b.name}</h4>
          <p><b>Service:</b> ${b.service}</p>
          <p><b>Date:</b> ${new Date(b.date).toDateString()}</p>
          <p><b>Time:</b> ${b.time}</p>
          <p><b>Status:</b> 
            <span style="color:${b.status === "Completed" ? "green" : "orange"}">
              ${b.status}
            </span>
          </p>

          <button onclick="markCompleted('${b._id}')"
            style="padding:8px 12px; background:green; color:white; border:none; border-radius:5px;">
            ‚úÖ Complete
          </button>

          <button onclick="deleteBooking('${b._id}')"
            style="padding:8px 12px; background:red; color:white; border:none; border-radius:5px;">
           ‚ùå Delete
          </button>
        </div>
      `).join("");
  });


/* ‚úÖ Mark booking as completed */
async function markCompleted(id) {
  try {
    const res = await fetch(
      `https://saloon-backend-plfu.onrender.com/api/bookings/${id}`,
      {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ status: "Completed" })
      }
    );

    const data = await res.json();

    if (res.ok) {
      alert("‚úÖ Booking marked as Completed!");
      location.reload();
    } else {
      alert("‚ùå Failed: " + data.error);
    }
  } catch (err) {
    alert("‚ùå Server error, try again");
  }
}


/* ‚ùå Delete booking */
async function deleteBooking(id) {
  if (!confirm("Are you sure you want to delete this booking?")) return;

  try {
    const res = await fetch(
      `https://saloon-backend-plfu.onrender.com/api/bookings/${id}`,
      {
        method: "DELETE"
      }
    );

    const data = await res.json();

    if (res.ok) {
      
  alert("Booking deleted successfully!");
  location.reload();
    } else {
      alert("‚ùå Delete failed: " + data.error);
    }
  } catch (err) {
    alert("‚ùå Server not responding");
  }
}

</script>

</body>
</html>

